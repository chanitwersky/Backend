<div class="admin-container">
  <div class="admin-header">
    <h2> 住专转  - 注专转</h2>
    <p>爪驻  砖转转 专转 驻 砖转砖</p>
  </div>

  <div class="table-wrapper">
    <table class="admin-table">
      <thead>
        <tr>
          <th>转专</th>
          <th>拽专</th>
          <th>转转-拽专</th>
          <th>砖 (Prompt)</th>
        </tr>
      </thead>
      
      <ng-container *ngFor="let user of allUserHistory">
        <tbody *ngIf="user.learningHistory?.length > 0">
          
          <tr class="user-group-row">
            <td colspan="4" class="user-header-cell">
              <i class="user-icon"></i>
              <strong>{{ user.name }}</strong>
              <span class="lesson-count">({{ user.learningHistory.length }} 砖注专)</span>
            </td>
          </tr>

          <tr *ngFor="let historyItem of user.learningHistory" class="history-item-row">
            <td class="date-column">{{ historyItem.createdAt | date:'dd/MM/yyyy HH:mm' }}</td>

            <td>
              <span class="category-badge main-cat">{{ historyItem.categoryName || '---' }}</span>
            </td>

            <td>
              <span class="category-badge sub-cat">{{ historyItem.subCategoryName || '---' }}</span>
            </td>
            
            <td class="prompt-cell" [title]="historyItem.prompt">
              {{ historyItem.prompt ? (historyItem.prompt | slice:0:80) : ' 转' }}
              {{ historyItem.prompt?.length > 80 ? '...' : '' }}
            </td>
          </tr>
        </tbody>
      </ng-container>
    </table>
  </div>

  <div *ngIf="!isLoading && allUserHistory.length === 0" class="no-data">
    <p> 爪 砖转砖 注专转.</p>
  </div>

  <div *ngIf="isLoading" class="loader">
    <p>注 转 砖专转...</p>
  </div>
</div>